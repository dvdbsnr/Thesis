% Chapter x
% Contains The proof for Theorem 3 (Z -> W)

\chapter{The breadth-first-walk on the random graph}
\todo{Update title.}

\section{Decompositions of $Z_n$}
\todo{Update title}
\todo{Add introductory text}

For ease of notation, we will drop the superscript $t$ from all random variables.

\begin{lemma} \label{lemma decomp Zn}
	The decomposition 
	\begin{equation} \label{decomp Zn}
	Z_n = M_n + A_n
	\end{equation}
	holds, where $M_n$ is a martingale and $A_n$ is defined by
	\begin{equation} \label{def An}
	\An{t} = \int_{0}^{t} a_n(s)ds - t
	\end{equation}
	and
	\begin{equation} \label{def an}
	a_n(s)ds = P(\text{A new edge appears in} \enspace [s, s+ds] \cond \Zn{u}, \enspace u \leq s).
	\end{equation}	
	\todo{Make text in P() not cursive?}
\end{lemma}
\begin{note} \label{note decomp Zn}
	$A_n$ is a continuous process of bounded variation, so jumps of $M_n$ are the same as jumps of $Z_n$. Since $Z_n$ and $A_n$ are of bounded variation, $M_n$ is a cadlaq process of bounded variation.
	\todo{Proof that An is of bounded variation.}
	\todo{Proof that Mn is cadlaq.}	
\end{note}
\begin{proof} \label{proof decomp Zn}
	We will prove that, for $A_n$ defined in \ref{def An} and \ref{def an},
	$Z_n - A_n$
	is a martingale by showing that
	\begin{equation} \label{Mn martingale}
	\Exp{ \Zn{t+u} - \An{t+u} \cond \F{t} } = \Zn{t} - \An{t} \quad \forall u \geq 0
	\end{equation}
	holds, where $\F{t}$ is the natural $\sigma$-algebra generated by $Z_n$, 
	$\F{t} = \sigma(\Zn{s}, s \leq t).$
	This is equivalent to 
	\begin{equation}
	\Exp{\Zn{t+u} - \Zn{t} \cond \F{t}} = \Exp{\An{t+u} - \An{t} \cond \F{t}}.
	\end{equation}
	
	We start with the left-hand side. 
	The difference between $Z_n$ at times $t$ and $t+u$ is the sum of all jumps that occurred in $[t, t+u]$ minus the constant downward drift $u$:
	\begin{align*}
	\Exp{\Zn{t+u} - \Zn{t} \cond \F{t}} 
	&= \Exp{\text{Number of jumps in} \enspace [t, t+u] \cond \F{t}} - u \\
	&= \Exp{\text{Number of new edges appearing in} \enspace [t, t+u] \cond \F{t}} - u,
	\end{align*}
	since every new edge corresponds to a jump of size $1$ in $Z_n$.
	
	Looking at the right-hand side, we define $\Esds$ as the event of a new edge appearing in the interval $[s,s+ds]$ and calculate
	\begin{align*}
	\Exp{\An{t+u} - \An{t} \cond \F{t}}
	&= \Exp{ \int_{0}^{t+u} a_n(s)ds - (t+u) - \int_{0}^{t} a_n(s)ds + t \cond \F{t} } \\
	&= \Exp{ \int_{t}^{t+u} a_n(s)ds \cond \F{t} } - u \\
	&= \int_{t}^{t+u} \Exp{a_n(s)ds \cond \F{t}} - u \\
	&= \int_{t}^{t+u} \Exp{ P(\Esds \cond \F{s}) \cond \F{t} } - u\\
	&= \int_{t}^{t+u} P( \Esds \cond \F{t} ) - u
	\quad \text{since} \enspace \F{s} \subseteq \F{t} \enspace \forall s \in [t,t+u] \\
	&= \Exp{\text{Number of new edges appearing in} \enspace [t, t+u] \cond \F{t}} - u.
	\end{align*}
	\todo{Fs \in Ft or Ft \in Fs? Use "tower property".}
	\todo{Explain "Number of new edges"="\int P" more detailed.}
	
	This proves $M_n$ to be a martingale. 	
\end{proof}

\begin{lemma} \label{lemma decomp Mn}
	The decomposition
	\begin{equation} \label{decomp Mn}
	M_n^2 = Q_n + B_n
	\end{equation}
	holds where $Q_n$ is a martingale and $B_n$ is defined by 
	\begin{equation} \label{def An}
	\Bn{t} = \int_{0}^{t} a_n(s)ds = A_n(t) + t
	\end{equation}
	with $a_n$ defined in \ref{def an}.
\end{lemma}
\begin{note} \label{note decomp Mn}
	$B_n$ is a continuous process.
\end{note}
\begin{proof} \label{proof decomp Mn}
	We will prove that
	$M_n^2 - B_n$
	is a martingale.
	Since $M_n$ is a right-continuous process of bounded variation, its quadratic variation
	\begin{equation*} \label{def quadratic variation}
	[M]_t := \limsup \sum (M_{t_i} - M_{t_{i-1}})^2
	\end{equation*}
	\todo{Add definition of quadratic variation.}
	is
	\begin{equation} \label{quadratic variation Mn}
	\Mnq{t} = \sum_{0 \leq s \leq t} (\Delta \Mn{s})^2,
	\end{equation}
	where
	$\Delta \Mn{s} := \Mn{s} - \Mn{s-}$ 
	can take one of two values: $1$ if there is a jump of $1$ at time $s$, 0 otherwise.
	\todo{Other word for "take".}
	We refer to [EK] to see that
	$M_n^2 - [M_n]$
	is a martingale.
	\todo{Add reference from [EK]}
	\todo{Nicer sentence.}
	Thus
	\begin{equation}
	M_n^2 - B_n = (\underbrace{M_n^2 - [M_n]}_{\text{martingale}}) + ([M_n] - B_n)
	\end{equation}
	and to prove \ref{decomp Mn} it suffices to show that
	$[M_n] - B_n$
	is a martingale.
	Using the fact that the jumps of $M_n$ are the jumps of $Z_n$ and
	$\Delta Z_n \in \lbrace0,1 \rbrace$
	we calculate
	\begin{align*}
	\Mnq{t} - \Bn{t}
	&= \sum_{0 \leq s \leq t} (\Delta \Mn{s})^2 - \Bn{t} \\
	&= \sum_{0 \leq s \leq t} (\Delta \Zn{s})^2 - \Bn{t} \\
	&= \sum_{0 \leq s \leq t} \Delta \Zn{s} - \Bn{t} \\
	&= \text{Number of jumps of} \enspace Z_n \enspace \text{in} \enspace [0,t] - \Bn{t} \\
	&= (\text{Number of jumps of} \enspace Z_n \enspace \text{in} \enspace [0,t] - t) - \An{t} \\
	&= \Zn{t} - \An{t}
	\end{align*}
	which is a martingale from Lemma \ref{lemma decomp Zn}.
	
\end{proof}

\begin{lemma} \label{lemma formula an}
	For $a_n$ as in the Lemmas above,
	\begin{equation}
		\an{s} = (n - s - \Zeta{\ceil{s}} - \Zn{s}) \ps .
	\end{equation}
	\todo{Update/change Zeta-symbol if needed.}
	\todo{Add explanation of Zeta if needed.}
\end{lemma}
\begin{proof} \label{proof formula an}
	proof.
	\todo{Add proof.}
\end{proof}

\section{Asymptotics}
\todo{Update title.}

We will now prove some asymptotic properties of the processes $A_n$, $B_n$ and $M_n$ with the goal of using the functional central limit theorem for martingales.
\todo{Update text.}

\begin{lemma} \label{lemma asymptotic An}
	For $A_n$ defined as in the previous Lemmas and a fix $s_0 \geq 0$,
	\begin{equation} \label{equ asymptotic An}
	\n{-1}{3} \supns \left| \An{s} + n^{-1}\frac{s^2}{2} - \n{-1}{3}st \right| \rightarrow_p 0,
	\end{equation}
	where $t$ is the fixed probability parameter of the random graph.
	\todo{Change/remove explanation of t: "probability parameter"}	
\end{lemma}
\begin{proof} \label{proof asymptotic An}
	We define $\amn{s}$ as
	\begin{equation}
		\amn{s} := (n - s - \Zeta{\ceil{s}} - \Zn{s}) p(n),
	\end{equation}
	which is $a_n$ without the denominator.
	\todo{Change "without the denominator"}
	First, we show that $\an{s}$ and $\amn{s}$ converge uniformly in $s$.
	\begin{equation}
	proof
	\end{equation}
	\todo{Add proof of uniform convergence.}
	Now we use the definition of $p(n)$ to expand
	\begin{align*}
	\amn{s} - 1 
	&= \left( n - s - \Zeta{\ceil{s}} - \Zn{s} \right) \left( n^{-1} + t\n{-4}{3} \right) - 1 \\
	&= 1 + t\n{-1}{3} - sn^{-1} - st\n{-4}{3} \\
	&\quad - \left( \Zeta{\ceil{s}} + \Zn{s} \right) \left( n^{-1} + t\n{-4}{3} \right) -1 .
	\end{align*}
	Thus
	\begin{equation} \label{equ (27)} 
	\begin{aligned}
	\left| \amn{s} - 1 + \frac{s}{n} - \frac{t}{\n{1}{3}} + \frac{st}{\n{4}{3}} \right|
	&= \left| \frac{\Zeta{\ceil{s}} + \Zn{s}}{n} \left( 1 + \frac{t}{\n{1}{3}} \right) \right| \\
	&\leq 2 \left| \frac{\Zeta{\ceil{s}} + \Zn{s}}{n} \right| \\
	&\leq 2 \frac{\Zeta{\ceil{s}} + |\Zn{s}|}{n} ,  
	\end{aligned}
	\end{equation}
	for $\n{1}{3} \geq |t|$. Note that $\Zeta{\ceil{s}} \geq 0$ for all $s \geq 0$.
	Integrating the inner part of the left-hand side over $s$ yields
	\todo{Make clear: We integrate the inner part of the LHS from 0 to s.}
	\begin{align*}
	\int_{0}^{s} \amn{u} - 1 + \frac{u}{n} - \frac{t}{\n{1}{3}} + \frac{ut}{\n{4}{3}} du
	&= \int_{0}^{s} \amn{u} - 1 du + \frac{s^2}{2n} - \frac{st}{\n{1}{3}} + \frac{s^2t}{2\n{4}{3}} \\
	&\xrightarrow{n \rightarrow \infty} \An{s} + \frac{s^2}{2n} - \frac{st}{\n{1}{3}} + \frac{s^2t}{2\n{4}{3}},
	\end{align*}
	Using \ref{lemma zeta(i)}, the following inequalities hold for sufficiently large $n$:
	\todo{Add reference to lemma.}
    \begin{align*}
    \left| \An{s} + \frac{s^2}{2n} - \frac{st}{\n{1}{3}}  + \frac{s^2t}{2\n{4}{3}}  \right| 
    &= \left| \int_{0}^{s} \amn{u} - 1 + \frac{u}{n} - \frac{t}{\n{1}{3}} + \frac{ut}{\n{4}{3}} du \right| \\
    &\leq \int_{0}^{s} \left|\amn{u} - 1 + \frac{u}{n} - \frac{t}{\n{1}{3}} + \frac{ut}{\n{4}{3}} \right| du \\
    &\leq \int_{0}^{s} 2 \frac{\Zeta{\ceil{u}} + |\Zn{u}|}{n} du \\
    &= \frac{2}{n}  \int_{0}^{s} 1-\min_{w \leq \ceil{u}-1} \Zn{w}  + |\Zn{u}| du \\
    &= \frac{2}{n}  \int_{0}^{s} |\Zn{u}| - \min_{w \leq \ceil{u}-1} \Zn{w} du + \BigO{\frac{s}{n}} \\
    &\leq \frac{4}{n} \max_{u \leq s} |\Zn{u}| + \BigO{\frac{s}{n}},
    \end{align*}
    the last inequality since $\ceil{u}-1 \leq s$ for $u\leq s$ and thus $|\min_{w \leq \ceil{u}-1}\Zn{w}| \leq \max_{u \leq s}|\Zn{u}|$.
    
    We define $A^*_n(s) := \An{s} + \frac{s^2}{2n} - \frac{st}{\n{1}{3}}$ and consider the difference
    \begin{align*}
    &\n{-1}{3}\supns | A^*_n{s} + \frac{s^2t}{2\n{4}{3}}  | - \n{-1}{3}\supns | A^*_n{s} | \\
    &\leq \n{-1}{3} \left( \supns | A^*_n{s} | + \supns |\frac{s^2t}{2\n{4}{3}}|  - \n{-1}{3}\supns | A^*_n{s} | \right) \\
    &= \n{-1}{3} \supns |\frac{s^2t}{2\n{4}{3}}| \\
    &= \n{-1}{3} \frac{s_0^2t}{2} \\
    &\xrightarrow{n \rightarrow \infty} 0,
    \end{align*}
    to see that proving
    \begin{align*}
    \n{-1}{3} \supns \frac{4}{n} \max_{u \leq s} |\Zn{u}| 
    &\leq 4 s_0 \n{-2}{3} \supns |\Zn{s}| \\
    &\longrightarrow_p 0 
    \end{align*}
    will suffice to prove \ref{equ asymptotic An}.
    For that, we will prove the stronger result 
    \begin{equation}
    n^{-2/3} \sup_{s\leq n^{-1/3} s_0} |Z_n(s)| 
    \enspace \text{is stochastically bounded as} \enspace n \rightarrow \infty ,
    \end{equation} 
    i.e. for any 
    $ \epsilon > 0 $ 
    there is a
    $ K > 0 $
    such that for $n$ sufficiently big 
    \begin{equation} \label{equ stoch bounded}
    P\left( n^{-1/3} \sup_{s\leq n^{2/3} s_0} |Z_n(s)| > K \right) < \epsilon. 
    \end{equation}
    
    Let $T^*_n$ be the first time $\n{-1}{3}|Z_n(s)|$ surpasses $K$ and  
    $T_n := T^*_n$ 
    if 
    $T^*_n \leq \n{2}{3}s_0$
    or else
    $\n{2}{3}s_0:$
    \begin{align*}
    T_n &:= \min \lbrace T^*_n, \n{2}{3}s_0 \rbrace , \\
    T^*_n &:= \min \lbrace s: |Z_n(s)| > K \n{1}{3} \rbrace .
    \end{align*}
    \todo{Define Tn, T*n nicer.}
    Thus 
    \begin{equation} \label{equ stoch bounded 2}
    \begin{aligned}
    P( \sup_{s\leq n^{2/3} s_0} |Z_n(s)| > K \n{1}{3} ) &= P ( |Z_n(T_n)| > K\n{1}{3} ) \\
    &\leq \frac{\Exp{|Z_n(T_n)}}{K}
    \end{aligned} 
    \end{equation}
    by Markov's inequality.
    To analyse $\Exp{|Z_n(T_n)|}$ we will use the previously established decompositions
    $Z_n = M_n + A_n$ and $M^2_n = Q_n + B_n$, 
    starting with the latter:
    
    Since $Q_n$ is a martingale, by the optional sampling theorem
    $\Exp{Q_n(\tau)} = 0$ 
    for all stopping times $\tau$.
    \begin{align*}
    \Exp{M^2_n(T_n)} &= \Exp{B_n(T_n)} \\
    &= \Exp{ \int_{0}^{T_n} a_n(s)ds } \\
    &= \int_{0}^{T_n} \Exp{a_n(s)} ds.
    \end{align*} 
    By definition
    \begin{align*}
    a_n(s) &= (n - \nu_n(s)) \frac{p(n)}{1 - (s - \floor{s})p(n)} \\
    &\leq \frac{n p(n)}{1 - (s - \floor{s})p(n)}
    \end{align*}
    which is a deterministic function in $s$. So
    $ \Exp{a_n(s)} \leq \frac{n p(n)}{1 - (s - \floor{s})p(n)} $
    and
    \begin{align*}
    \int_{0}^{T_n} \Exp{a_n(s)} ds &\leq  \int_{0}^{T_n }\frac{n p(n)}{1 - (s - \floor{s})p(n)} \\
    &\leq \int_{0}^{\n{2}{3}s_0}\frac{n p(n)}{1 - (s - \floor{s})p(n)} \\
    &\leq 2\n{2}{3}s_0,
    \end{align*}
    where the last inequality holds for $n$ sufficiently large, since 
    $\frac{n p(n)}{1 - (s - \floor{s})p(n)} \rightarrow 1$
    as $n \rightarrow \infty$.
    We conclude
    \begin{equation} \label{equ exp Mn}
    \Exp{M_n(T_n)} \leq (2s_0)^{1/2}\n{1}{3}
    \end{equation}
    and move to $A_n$.
    
    Using \ref{equ (27)} and \ref{lemma zeta(i)} we obtain
    \begin{align*}
    \Exp{|\An{T_n}|} &\leq \Exp{\int_{0}^{T_n} |\an{s}-1|ds} \\
    &\leq \Exp{\int_{0}^{\n{2}{3}s_0} |\an{s}-1|ds} \\
    &\leq \Exp{
    	\int_{0}^{T_n} | \an{s} + \amn{s} - \amn{s} + \frac{s}{n} - \frac{t}{\n{1}{3}} + \frac{st}{\n{4}{3}
    	} \\
    &\qquad \qquad - \frac{s}{n} + \frac{t}{\n{1}{3}} - \frac{st}{\n{4}{3}} | ds} \\
    &\leq \Exp{
    	\int_{0}^{T_n} |\an{s} - \amn{s}|ds \\
    	&\qquad + \int_{0}^{T_n} |\frac{s}{n} - \frac{t}{\n{1}{3}} + \frac{st}{\n{4}{3}}| ds \\
    	&\qquad + \int_{0}^{T_n} |\amn{s} - 1 + \frac{s}{n} - \frac{t}{\n{1}{3}} + \frac{st}{\n{4}{3}}|
    } \\
    &\leq \n{2}{3}s_0 \BigO{\frac{1}{n}} + \n{2}{3}s_0 \BigO{\frac{|t|}{\n{1}{3}}} \\
    &\qquad +  \n{2}{3}s_0 \left( \frac{4s}{n} \max_{u \leq T_n}|\Zn{u}| + \BigO{\frac{T_n}{n}}\right) \\
    &\leq 4 s_0 K + s_0|t|\BigO{\n{1}{3}} + s_0^2\BigO{\n{1}{3}} + s_0\BigO{\frac{1}{\n{1}{3}}},
    \end{align*}
    \todo{Fix BigO-Notation (Sapozhnikov?)}
    since, by definition of $T_n$, $|\Zn{T_n}| < K\n{1}{3}.$
    
    This and \ref{equ exp Mn} lead to a bound for large $n$:
    \begin{equation} \label{equ bound Zn}
    \Exp{|\Zn{T_n}|} \leq \alpha\n{1}{3} + 4s_0K,
    \end{equation}
    where $\alpha = \alpha(s_0,t)$ but not dependent on $n$ and $K$. 
    Substituting $\Exp{|\Zn{T_n}|}$ in \ref{equ stoch bounded 2} we arrive at
    \begin{equation}
    P( \sup_{s\leq n^{2/3} s_0} |Z_n(s)| > K \n{1}{3} ) \leq \frac{\alpha}{K} + \frac{4s_0}{\n{1}{3}}
    \end{equation}
    which proves \ref{equ stoch bounded}.
\end{proof}

\begin{lemma} \label{lemma asymptotic Bn}
	For $B_n$ defined as in the previous Lemmas and a fix $s_0 \geq 0$,
	\begin{equation} \label{equ asymptotic Bn}
	\n{-2}{3} \Bn{\n{2}{3}s_0} \rightarrow_p s_0.
	\end{equation}
\end{lemma}
\begin{proof} \label{proof asymptotic Bn}
	From its definition in Lemma \ref{lemma decomp Mn}, $\Bn{s} = \An{s} + s$, which allows us to rewrite \ref{equ asymptotic Bn} as
	\begin{equation} \label{equ asymptotic Bn An}
	\n{-2}{3} \An{\n{-2}{3}s_0} \rightarrow_p 0.
	\end{equation}
	We will show that
	\begin{equation} \label{equ asymptotic Bn An + c}
	\n{-1}{3} \An{\n{-2}{3}s_0} + \frac{1}{2}s_0^2 - s_0t \longrightarrow_p 0,
	\end{equation}
	where again $t$ denotes the probability parameter. 
	\todo{Change "probability parameter"}
	This implies
	\begin{equation*}
	\n{-1}{3} \left( \n{-1}{3} \An{\n{-2}{3}s_0} + \frac{1}{2}s_0^2 - s_0t \right) \longrightarrow_p 0
	\end{equation*}
	which, since $\frac{1}{2}s_0^2 - s_0t$ is a constant in $n$, proves \ref{equ asymptotic Bn An}.
	
	Let the function $\phi$ be defined by $\phi(s) = \frac{1}{2}\n{-4}{3}s^2 - \n{-2}{3}st$.	
	Now $\phi(\n{2}{3}s_0) = \frac{1}{2}s_0^2 - s_0t$ and
	\begin{align*}
	\left| \n{-1}{3} \An{\n{-2}{3}s_0} + \frac{1}{2}s_0^2 - s_0t \right| 
	&= \left| \n{-1}{3} \An{\n{-2}{3}s_0} + \phi(\n{2}{3}s_0) \right| \\
	&\leq \supns \left| \n{-1}{3} \An{s} + \phi(s) \right| \\
	&= \n{-1}{3} \supns \left| \An{s} + n^{-1}\frac{s^2}{2} - \n{-1}{3}st \right| \\
	&\longrightarrow_p 0,
	\end{align*}
	as $n \rightarrow \infty$ from Lemma \ref{lemma asymptotic An}. This gives \ref{equ asymptotic Bn An + c} and completes the proof.
\end{proof}
















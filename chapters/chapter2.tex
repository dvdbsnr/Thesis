% Chapter x
% Contains The proof for Theorem 3 (Z -> W)

\chapter{The breadth-first-walk on the random graph}
\todo{Update title.}

For ease of notation, we will drop the superscript $t$ from all random variables.

\begin{lemma} \label{lemma decomp Zn}
	The decomposition 
	\begin{equation} \label{decomp Zn}
	Z_n = M_n + A_n
	\end{equation}
	holds, where $M_n$ is a martingale and $A_n$ is defined by
	\begin{equation} \label{def An}
	\An{t} = \int_{0}^{t} a_n(s)ds - t
	\end{equation}
	and
	\begin{equation} \label{def an}
	a_n(s)ds = P(\text{A new edge appears in} \enspace [s, s+ds] \cond \Zn{u}, \enspace u \leq s).
	\end{equation}	
\end{lemma}
\todo{Make text in P() not cursive?}
\begin{note} \label{note decomp Zn}
	$A_n$ is a continuous process of bounded variation, so jumps of $M_n$ are the same as jumps of $Z_n$. Since $Z_n$ and $A_n$ are of bounded variation, $M_n$ is a cadlaq process of bounded variation.	
\end{note}
\todo{Proof that An is of bounded variation.}
\todo{Proof that Mn is cadlaq.}
\begin{proof} \label{proof decomp Zn}
	We will prove that, for $A_n$ defined in \ref{def An} and \ref{def an},
	$Z_n - A_n$
	is a martingale by showing that
	\begin{equation} \label{Mn martingale}
	\Exp{ \Zn{t+u} - \An{t+u} \cond \F{t} } = \Zn{t} - \An{t} \quad \forall u \geq 0
	\end{equation}
	holds, where $\F{t}$ is the natural $\sigma$-algebra generated by $Z_n$, 
	$\F{t} = \sigma(\Zn{s}, s \leq t).$
	This is equivalent to 
	\begin{equation}
	\Exp{\Zn{t+u} - \Zn{t} \cond \F{t}} = \Exp{\An{t+u} - \An{t} \cond \F{t}}.
	\end{equation}
	
	We start with the left-hand side. 
	The difference between $Z_n$ at times $t$ and $t+u$ is the sum of all jumps that occurred in $[t, t+u]$ minus the constant downward drift $u$:
	\begin{align*}
	\Exp{\Zn{t+u} - \Zn{t} \cond \F{t}} 
	&= \Exp{\text{Number of jumps in} \enspace [t, t+u] \cond \F{t}} - u \\
	&= \Exp{\text{Number of new edges appearing in} \enspace [t, t+u] \cond \F{t}} - u,
	\end{align*}
	since every new edge corresponds to a jump of size $1$ in $Z_n$.
	
	Looking at the right-hand side, we define $\Esds$ as the event of a new edge appearing in the interval $[s,s+ds]$ and calculate
	\begin{align*}
	\Exp{\An{t+u} - \An{t} \cond \F{t}}
	&= \Exp{ \int_{0}^{t+u} a_n(s)ds - (t+u) - \int_{0}^{t} a_n(s)ds + t \cond \F{t} } \\
	&= \Exp{ \int_{t}^{t+u} a_n(s)ds \cond \F{t} } - u \\
	&= \int_{t}^{t+u} \Exp{a_n(s)ds \cond \F{t}} - u \\
	&= \int_{t}^{t+u} \Exp{ P(\Esds \cond \F{s}) \cond \F{t} } - u\\
	&= \int_{t}^{t+u} P( \Esds \cond \F{t} ) - u
	\quad \text{since} \enspace \F{s} \subseteq \F{t} \enspace \forall s \in [t,t+u] \\
	&= \Exp{\text{Number of new edges appearing in} \enspace [t, t+u] \cond \F{t}} - u.
	\end{align*}
	\todo{Fs \in Ft or Ft \in Fs? Use "tower property".}
	\todo{Explain "Number of new edges"="\int P" more detailed.}
	
	This proves $M_n$ to be a martingale. 	
\end{proof}

\begin{lemma} \label{lemma decomp Mn}
	The decomposition
	\begin{equation} \label{decomp Mn}
	M_n^2 = Q_n + B_n
	\end{equation}
	holds where $Q_n$ is a martingale and $B_n$ is defined by 
	\begin{equation} \label{def An}
	\Bn{t} = \int_{0}^{t} a_n(s)ds = A_n(t) + t
	\end{equation}
	with $a_n$ defined in \ref{def an}.
\end{lemma}
\begin{note} \label{note decomp Mn}
	$B_n$ is a continuous process.
\end{note}
\begin{proof} \label{proof decomp Mn}
	We will prove that
	$M_n^2 - B_n$
	is a martingale.
	Since $M_n$ is a right-continuous process of bounded variation, its quadratic variation
	\begin{equation*} \label{def quadratic variation}
	[M]_t := \limsup \sum (M_{t_i} - M_{t_{i-1}})^2
	\end{equation*}
	\todo{Add definition of quadratic variation.}
	is
	\begin{equation} \label{quadratic variation Mn}
	\Mnq{t} = \sum_{0 \leq s \leq t} (\Delta \Mn{s})^2,
	\end{equation}
	where
	$\Delta \Mn{s} := \Mn{s} - \Mn{s-}$ 
	can take one of two values: $1$ if there is a jump of $1$ at time $s$, 0 otherwise.
	\todo{Other word for "take".}
	We refer to [EK] to see that
	$M_n^2 - [M_n]$
	is a martingale.
	\todo{Add reference from [EK]}
	\todo{Nicer sentence.}
	Thus
	\begin{equation}
	M_n^2 - B_n = (\underbrace{M_n^2 - [M_n]}_{\text{martingale}}) + ([M_n] - B_n)
	\end{equation}
	and to prove \ref{decomp Mn} it suffices to show that
	$[M_n] - B_n$
	is a martingale.
	Using the fact that the jumps of $M_n$ are the jumps of $Z_n$ and
	$\Delta Z_n \in \lbrace0,1 \rbrace$
	we calculate
	\begin{align*}
	\Mnq{t} - \Bn{t}
	&= \sum_{0 \leq s \leq t} (\Delta \Mn{s})^2 - \Bn{t} \\
	&= \sum_{0 \leq s \leq t} (\Delta \Zn{s})^2 - \Bn{t} \\
	&= \sum_{0 \leq s \leq t} \Delta \Zn{s} - \Bn{t} \\
	&= \text{Number of jumps of} \enspace Z_n \enspace \text{in} \enspace [0,t] - \Bn{t} \\
	&= (\text{Number of jumps of} \enspace Z_n \enspace \text{in} \enspace [0,t] - t) - \An{t} \\
	&= \Zn{t} - \An{t}
	\end{align*}
	which is a martingale from Lemma \ref{lemma decomp Zn}.
	
\end{proof}

\begin{lemma} \label{lemma formula an}
	For $a_n$ as in the Lemmas above,
	\begin{equation}
		\an{s} = (n - s - \Zeta{\ceil{s}} - \Zn{s}) \ps .
	\end{equation}
\end{lemma}
\todo{Update/change Zeta-symbol if needed.}
\todo{Add explanation of Zeta if needed.}
\begin{proof} \label{proof formula an}
	proof.
\end{proof}
\todo{Add proof.}

We will now prove some asymptotic properties of the processes $A_n$, $B_n$ and $M_n$ with the goal of using the functional central limit theorem for martingales.
\todo{Update text.}

\begin{lemma} \label{lemma asymptotic An}
	For $A_n$ defined as in the previous Lemmas and a fix $s_0 \geq 0$,
	\begin{equation}
	\n{-1}{3} \supns \left| \An{s} + n^{-1}\frac{s^2}{2} - \n{-1}{3}st \right| \rightarrow_p 0,
	\end{equation}
	where $t$ is the fix probability parameter of the random graph.	
\end{lemma}
\todo{Change/remove explanation of t: "probability parameter"}
\begin{proof}
	We define $\amn{s}$ as
	\begin{equation}
		\amn{s} := (n - s - \Zeta{\ceil{s}} - \Zn{s}) p(n),
	\end{equation}
	which is $a_n$ without the denominator.
	\todo{Change "without the denominator"}
	First, we show that $\an{s}$ and $\amn{s}$ converge uniformly in $s$.
	\begin{equation}
	proof
	\end{equation}
	\todo{Add proof of uniform convergence.}
	Now we use the definition of $p(n)$ to expand
	\begin{align}
	\amn{s} - 1 
	&= (n - s - \Zeta{\ceil{s}} - \Zn{s}) \left( \frac{1}{n}+ \frac{t}{\n{4}{3}} \right) - 1 \\
	&= 1 - \frac{s}{n} - \frac{\Zeta{\ceil{s}}}{n} - \frac{\Zn{s}}{n} \\
	&\qquad + \frac{t}{\n{1}{3}} - \frac{st}{\n{4}{3}} - \frac{\Zeta{\ceil{s}}t}{\n{4}{3}} - \frac{\Zn{s}t}{\n{4}{3}} - 1\\
	&= 
	\end{align}
	
\end{proof}
























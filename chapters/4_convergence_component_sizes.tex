% Chapter 4: Convergence of component sizes
% Contains:
%   Explanation on what's still missing
%   The deterministic lemma (Lemma 7)
%   Girsanov Theorem
%   Applying Lemma 7 (Lemma 8)
%   Graph theory approach:
%     Lemma 9
%   l2 approach:
%     Definitions on l2
%     Deterministic lemma (Lemma 14)
%     Proposition 15
%     Applying Prop 15 to the bf-walk

\chapter{Convergence of component sizes}
\fxnote{Update title.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% What's still missing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Deterministic Lemma 7: Statement and Note
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{lemma} \label{L: Deterministic Lemma}
	Let $f:[0, \infty) \rightarrow \Real$ be a continuous function. 
	Let $\mathcal{E}$ be the set of non-empty intervals 
	$e=(l,r) \subset \Real_{\geq 0}$
	such that
	\begin{equation} \label{E: f cond 1}
	f(r) = f(l) = \min_{s \leq l} f(s),
	\end{equation}
	\begin{equation} \label{E: f cond 2}
	f(l) < f(s) \quad \forall l < s < r.
	\end{equation}
	Define $\Xi := \lbrace (l, r-l) \; | \; (l, r) \in \mathcal{E} \rbrace$.
	
	Suppose that for intervals $e_1, e_2 \in \mathcal{E}$ we have 
	\begin{equation} \label{E: f cond f(l1) > f(l2)}
	f(l_1) > f(l_2)
	\end{equation}
	and the complement of $\cup_{e \in \mathcal{E}} (l,r)$ has Lebesgue measure zero,
	\begin{equation} \label{E: f cond complement zero}
	\mu \left( \left( \cup_{e \in \mathcal{E}} (l,r) \right)^c\right) = 0.
	\end{equation}
	
	Let $f_n \rightarrow f$ as $n \rightarrow \infty$ uniformly on bounded intervals.
	Suppose $(\tn{i}, i \geq 1)$ satisfy the following conditions:
	
	\begin{equation} \label{E: fn cond 3}
	0 = \tn{1} < \tn{2} < ... \; \text{and} \; \lim_{i \rightarrow \infty} \tn{i} = \infty,
	\end{equation}
	\begin{equation} \label{E: fn cond 4}
	f_n(\tn{i}) = \min_{u \leq \tn{i}}f_n(u), 
	\end{equation}
	\begin{equation} \label{E: fn cond 5}
	\max_{i: \tn{i} \leq s_0}(f_n(\tn{i}) - f_n(\tn{i+1})) \rightarrow 0 \; \text{as} \; n \rightarrow \infty, \; \text{for all} \; s_0 \leq \infty.
	\end{equation}
	
	Define $\Xin := \lbrace (\tn{i}, \tn{i+1} - \tn{i}) \; | \; i \geq 1 \rbrace$.
	Then $\Xin \rightarrow \Xi$ as $n \rightarrow \infty$.
\end{lemma}
\fxnote{Conditions in Lemma -> Ask Sapozhnikov}

\begin{note}
	The convergence
	$\Xin \rightarrow_d \Xi$
	is to be interpreted as the vague convergence of counting measures,
	which means that for all continuous functions
	$f: \IntTimesInt \rightarrow \Real$
	with compact support,
	\begin{equation}
		\Exp{f(\Xin)} \rightarrow \Exp{f(\Xi)}.
	\end{equation}
	By general theory,
	see for example \cite{Kallenberg1990},
	\fxnote{Add real reference here}
	this is equivalent to the convergence
	\begin{equation}
	\Xin(C) \rightarrow \Xi(C)
	\end{equation}
	for all compact subsets of
	$\IntTimesInt$,
	where $\Xi(\partial C) = 0$.
	In this case, a compact subset is a pair of closed intervals
	$[T_1, T_2] \times [d_1, d_2]$,
	with $T_1, T_2 \geq 0$
	and $d_1, d_2 > 0$.
	The condition on the measure of the boundary means,
	that the limit process must not have any excursions starting exactly at
	$T_1$ or $T_2$,
	or any excursions of length exactly $d_1$ or $d_2$.
	An exception is the case of $T_1=0$.
	Since the domain of $f$ starts at $0$,
	and the boundary condition is needed to prevent the case of points in $\Xin$ converging to some point on the boundary "from outside",
	\fxnote{This is not really a boundary condition.}
	\fxnote{Are "" around "from outside" needed?}
	\fxnote{This is not a nice sentence in general.}
	we do not need to consider $0$ as part of the boundary of any interval 
	$[0, T_2] \times [d_1, d_2]$.
\end{note}
\fxnote{Does this fit in the note? 
	General stuff about vague convergence should not be in the proof.
	Maybe vague convergence before the Lemma, interval stuff in the note.}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Deterministic Lemma 7: Proof
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proof}
%	Structure:
%	- What does the definition of \Xi and \Xin mean?
%	- Detail on \Xin and conditions
%   First part: \Xi in \Xin
%   (For every f exc, there is an fn exc)
%	- Facts about f:
%	 - It goes up to the left and right of l
%	 - It goes down to the right of r? (Or later)
%	 - eps/delta stuff
%	- Arch of fn
%	- Definition ln(x)
%	- ln(x) in [l-e, l+e]
%	- Definition rn(x)
%	- rn(x) in [r-e, r+e]
We begin by elaborating what the conditions
\eqref{E: f cond 1} to \eqref{E: fn cond 5}
mean for the points in
$\Xi$ and $\Xin$.
\fxfatal{Some stuff about excursions goes here.}

To prove the Lemma, 
we fix some bounded subset of
$\IntTimesInt$,
$C := [T_1, T_2] \times [d_1, d_2]$,
and show that, for sufficiently high $n$,
$\Xin(C) = \Xi(C)$,
that is,
there are exactly as many excursions of $f_n$ starting in
$(T_1, T_2)$, 
with length in $(d_1, d_2)$,
as similar excursions of the limit function $f$.

We will first show that every excursion of $f$ is eventually matched by some excursion of $f_n$,
then show that there can not be any more excursion of $f_n$ of sufficient length.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Proof Part 1: \Xi in \Xin
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proofpart}[$\Xin(C) \subseteq \Xi(C)$]

Let us first establish some facts about excursions of the limit function $f$.
In the interval $[T_1, T_2]$,
there can only be a finite number of excursion starting with length of at least $d_1$,
at most $T_1/d_1$.
\fxnote{Fix this sentence!}
Let
$ \mathcal{E}^* := \{ (l_i, r_i) \; | \; i=1, \dots, k \} $
be the set of these excursions.
Consider a fix
$(l,r) \in \mathcal{E}^*$.
\fxnote{Some figure showing an excusion goes here probably.}
Since $l-r > d_1$,
we can find an $\epsilon > 0$
such that the length of the interval
$[l+\epsilon, r-\epsilon]$
is still greater than $d_1$.
We can also find an $\epsilon > 0$ sufficiently small,
so that for every
$x \in [0, l-\epsilon] \cup [l+\epsilon, r-\epsilon]$,
\begin{equation}
f(x) > f(l) + \delta
\end{equation}
holds for some $\delta > 0$.
	
	
\end{proofpart}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Proof Part 2: \Xin in \Xi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proofpart}[$\Xi(C) \subseteq \Xin(C)$]
	\lipsum[100]
\end{proofpart}

	
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Lemma 8: Statement
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The following Lemma will now link $Z_n$ and $\Wt$ in the language of Lemma \ref{L: Deterministic Lemma}
Define $\gamma (n, i) \in \{1, \dots, n\}$ to be the index that makes
$v(\gamma(n,i))$ is the last vertex of the $i-1$-st component encountered by the breadth-first walk $Z_n$.
\fxnote{Text clunky here.}
Let $\Ci{n,i}$ be the size of the $i$-th component.
\fxnote{Fix i indices}

\begin{lemma} \label{L: Lemma 8}
	Let $\Xi$ be the point process with points corresponding to excursions of $\Bt$,
	\begin{equation} \label{E: Lemma 8 def Xi}
	\Xi := \{ (l(\gamma), |\gamma|) \; | \; \gamma \; \text{excursion of} \; \Bt \}.
	\end{equation}
	Let $\Xin$ be the point process with points corresponding to excursions of the breadth-first walk
	\begin{equation} \label{E: Lemma 8 def Xin}
	\Xin := \{ ( \n{-2}{3} \gamma(n,i), \n{-2}{3} \Ci{n,i} ) \; | \; i \geq 1 \}.
	\end{equation}
	Then $\Xin \rightarrow \Xi$ as $n \rightarrow \infty$.
\end{lemma}
\fxnote{Try not to repeat the same sentence twice here.}

Before proving this Lemma, we need to state Girsanov's Theorem, 
which will enable us to prove certain properties of the Brownian motion with drift.
\fxnote{Explanation here or at the end?}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Girsanov Theorem
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
We state the theorem as in \cite[Theorem 5.2.3]{Shreve2004}
\begin{theorem}[Girsanov] \label{T: Girsanov}
	Let $W(t), 0 \leq t \leq T$, be a Brownian motion on a probability space
	$(\Omega, \mathcal{F}, \mathbb{P})$.
	Define
	\begin{align}
	\tilde{W}(t) &:= W(t) + \int_0^t \Theta(u)du, \label{E: Girsanov def W tilde} \\ 
	Z(t) &:= \exp \left\{ -\int_{0}^{t} \Theta(u) dW(u) - \frac{1}{2} \int_0^t \Theta^2(u)du \right\}. \label{E: Girsanov def Z}
	\end{align}
	Assume that
	\begin{equation} \label{E: Girsanov cond Theta}
	\ExpBig{ \int_{0}^{T} \Theta^2(u) Z^2(u)du  } < \infty.
	\end{equation}
	Set the random variable $Z=Z(T)$. Then $\Exp{Z(T)} = 1$ and $\mathbb{Q}$, defined by
	\begin{equation} \label{E: Girsanov def Q}
	\mathbb{Q}(A) := \int_A Z(\omega) d\mathbb{P}(\omega), \; \text{for all} \; A \in \mathcal{F},
	\end{equation}
	is a probability measure under which the process 
	$\tilde{W}(t)$, $0 \leq t \leq T$, 
	is a standard Brownian motion.
\end{theorem}
\fxerror{Check definition of Z=Z(T) in other references!}
\fxfatal{Brownian Motion -> Brownian motion in whole document!}
\fxerror{Q are already the rational numbers.}
\fxfatal{E(Z) = 1 is not a result, but a condition!}

We can apply this Theorem to the Brownian motion with drift $W^t$ as follows:
$\Wt(s) = W(s) + ts - \frac{1}{2} s^2 = W(s) + \int_0^s (t-u)du $.
Since $\Theta(u) = t-u$ obviously satisfies \ref{E: Girsanov cond Theta} for $T < \infty$,
$\Wt$ is a standard Brownian motion under the probability measure $\mathbb{Q}$, 
as defined in \eqref{E: Girsanov def Q}. 
From it's definition in \eqref{E: Girsanov def Z}, $Z(T) > 0$ with probability $1$.
Thus, for all sets $A \in \mathcal{F}$,
\begin{equation} \label{E: P0 = Q0}
\mathbb{P}(A) = 0 \iff \mathbb{Q}(A) = 0.
\end{equation}
This means, that events that happen with probability $0$ under the measure $\mathbb{Q}$ also happen with probability $0$ under $\mathbb{P}$.
\fxerror{That's literally what it means. Some more interpretation might be nice.}
We will use this result to proof certain properties of the Brownian motion with drift,
by showing that these properties hold for the standard Brownian motion with probability $1$ and changing the measure.
\fxerror{Explain: "Changing the measure." Or fix this sentence after proof is complete.}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Lemma 8: Proof
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proof}[Proof of Lemma \ref{L: Lemma 8}]
	By the definition of $\Bt$, 
	$\Xi$ is the $\Xi$ in Lemma \ref{L: Deterministic Lemma} with $f = \Wt$.
	Taking $f_n$ to be $\bar{Z}_n$ and defining $\tn{i} = \n{-2}{3} \gamma(n,i)$,
	$\Xin$ is the $\Xin$ in Lemma \ref{L: Deterministic Lemma}.
	
	By Theorem \ref{T: Z -> W} we know $\bar{Z}_n \rightarrow_d \Wt$.
	\fxnote{Add this Theorem}
	By the Skorohod representation theorem,
	see \cite{Billingsley2009}, 
	\fxnote{Add reference.}
	\fxnote{Explain Skorohod.}
	we know there exist a probability space $(\Omega, F, P)$ such that
	\fxnote{Add real probability space.}
	$\bar{Z}_n \rightarrow_{a.s} \Wt$ on $(\Omega, F, P)$.
	By Egorov's theorem, \cite{Someting},
	\fxnote{Add citation}
	$\bar{Z}_n$ converges to $\Wt$ uniformly on bounded intervals .
	\fxnote{Is that true? Ask Sapoznikov}
	We still need to show that conditions \eqref{E: f cond 1} to \eqref{E: f cond complement zero} hold for $\Wt$
	and conditions \eqref{E: fn cond 3} to \eqref{E: fn cond 5} hold for the breadth-first walk.
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Conditions on BM
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	We start with the former. 
	We first define the set $\mathcal{E}$ for the Brownian motion.
	Consider the set of positive rational numbers.
	For every $q \in \Rat^+$, 
	set $l(q) := \sup( \underset{s \leq q}{\argmin} \Wt(s) ) $ 
	and $r(q) := \inf( {s \in \Real \; | \; \Wt(s) = l(q)} ) $.
	\fxerror{In this definition, if q is a minimum, l(q) = r(q) = q}
	Now every rational number belongs to one excursion $(l(q), r(q))$,
	while one excursion contains multiple rational numbers.
	We define the set of excursions
	\begin{equation}
	\mathcal{E} := \bigcup_{q \in \Rat^+} \{ (l(q), r(q)) \}
	\end{equation}
	and note that it is countable.
	\fxnote{When do we need countability? For the set definition?}
	The following properties will be proven on the standard Brownian motion $W$,
	we later take the step to $\Wt$.
	\fxnote{"Take the step" - Lame!}
	
	We first make sure that every interval $[l_i, r_i]$ is in fact non-trivial and condition \ref{E: f cond 2} is met,
	since the definition above permits the case $l(q) = r(q) = q$.
	\fxerror{OR: Fix the definition. -> Talk to Sapozhnikov?}
	\fxerror{Here goes the proof of that. Some stuff about rational numbers.}
	
	The complement of all excursion is the set of intervals,
	on which the Brownian motion is monotonously decreasing.
	But, see \cite[Theorem 1.22]{Peres2008}, with probability $1$,
	$W$ is not monotonous on any interval $[a,b]$ with $0 < a < b < \infty$.
	\fxerror{Is that enough to prove that there is no monotonous interval?}
	
	These properties hold with probability $1$ for the standard Brownian motion.
	So they hold with probability $1$ for $\Wt$ under $\mathbb{Q}$
	and, by \eqref{E: P0 = Q0}, 
	almost surely for $\Wt$ under the original measure $\mathbb{P}$.
	\fxnote{"probability 1" - looks weird!}
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Conditions on Zn
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	We now show that conditions 
	\eqref{E: fn cond 3} to \eqref{E: fn cond 5}
	hold for the random walk $Z_n$ and $\Xin$
	as defined in \eqref{E: Lemma 8 def Xin}.
	
	\fxfatal{Add this after the alternative definition random walk.
	For the real references.}


	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Finishing the proof
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	We can now apply Lemma \ref{L: Lemma 8} and obtain the vague convergence
	$ \Xin \rightarrow_d \Xi $.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% What's still missing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\section{Graph-theory approach}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION: Graph-theory approach
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% T(y) and T_n(y)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Lemma 9: Graph Components
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{lemma} \label{L: Lemma 9}
	Let $p(n, y, \delta)$ be the chance that $\Gcal \in \Gnt$
	contains a component of size greater than or equal to $\delta \n{2}{3}$
	which does not contain any vertex $i$ with $1 \leq i \leq y\n{1}{3}$.
	
	Then
	\begin{equation}
	\lim_{y \rightarrow \infty} \limsup_n p(n, y, \delta) = 0 \enspace
	\end{equation}
	for all $\delta > 0$.
\end{lemma}
\begin{proof}
	This is the proof
\end{proof}








\section{$l^2$-approach}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION: l2-approach
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
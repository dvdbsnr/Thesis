% Chapter 3: Surplus edges
% Contains:
%   Definition of surplus edges
%   Eligible edges for s.e.
%   Calculating the probability of s.e.
%   The proof of (Z_n, N_n) => (W,N)
%   Why the overestimated probability is OK

\chapter{Surplus edges}
\fxnote{Update title.}

Theorem~\ref{T: Main} deals with surplus edges.
The goal of this chapter will be to first define the notion of surplus edges,
find a way to estimate the probability of encountering one and finally proving the joint convergence of $Z_n$ and the other process.

\section{Counting surplus edges}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION: Counting surplus edges
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\fxnote{Update title.}

We begin by describing a way to analyse the appearance of surplus edges.
In Chapter~\ref{C: bf-walk} we defined the breadth-first walk $Z_n$, 
which counted new connections to previously disconnected vertices.
We remind ourselves that a surplus edge in a graph $\Gcal \in \Gnt$ appears if,
during the transition of vertices and components of the breadth-first walk,
a vertex opens a new connection to another vertex, 
which already has opened connections to some explored node.
We associate with $\Gcal$ a counting process $(\nnt(s), 0 \leq s \leq n)$,
with $\nnt(0) = 0$, which increases by $1$ at each appearance of a surplus edge.

In fact $\nnt$ is a process very similar to $B_n$,
the process defined in Chapter~\ref{C: bf-walk} that counted each appearance of a new edge to an ineligible vertex.
Lemma~\ref{L: formula an} established that $\Bn{t} = \int_{0}^{t} \an{s}ds$ with
\begin{equation*}
	\an{s} = (n - \Ineligible{s}) \ps,
\end{equation*}
where $\Ineligible{s}$ is the number of vertices ineligible to become a child of $v(\ceil{s})$ at time $s$.
In terms of counting processes, we call $a_n$ the rate or conditional intensity of $B_n$.
It is evident that $\nnt$ will have a similar rate,
substituting the number of vertices eligible to become a child of $v(\ceil{s})$ with the number of vertices eligible to receive a surplus edge to $v(\ceil{s})$.

\begin{figure}[ht]
	\input{figures/fig_tree1.tex}
	\caption{A tree} 
	\label{F: Surplus Edges Tree}
\end{figure}

Consider the breadth-first walk on the graph of Figure~\ref{F: Surplus Edges Tree} at time $2$.
The children of $v_1$, $v_2$ to $v_4$, and the children of $v_2$, that is $v_5$ and $v_6$, are already discovered.
We are interested in surplus edges to $v_3$.
So $v_1$ to $v_6$ are unable to form edges to become children of $v_3$ and $\Ineligible{2} = |\{ v_1, \dots,  v_6\}|$.
Of these vertices, $v_1$ and $v_2$ are already explored an every connection to other nodes is known.
Vertex $v_3$ can not have an edge to itself, so only $v_4$, $v_5$ and $v_6$ are eligible to receive a surplus edge to $v_3$.

In general, at time $i-1$, the first $i$ vertices are ineligible for a surplus edge to $v(i)$.
The remaining $\Ineligible{i-1} - i$ vertices are candidates for an excess edge opening with probability $\p$.
Therefore, the counting process $\nnt$ has rate
\begin{equation} \label{E: rate Nnt}
(\Ineligible{\floor{s}} - \floor{s}) \ps.
\end{equation}
Note that this rate is only exact for the chance of encountering exactly one surplus edge, 
but an overestimation for multiple excess edges.
If we encounter a surplus edge at some time $s \in [i-1, i)$,
the number of eligible vertices should decrease by one.
However, \eqref{E: rate Nnt} is constant for all $s \in [i-1, i)$.
For ease of computation we will continue with this overestimation and later argue that the difference becomes negligible as $n \rightarrow \infty$.

Lemma~\ref{L: formula an} established $\Ineligible{s} = s + \Zetan{\ceil{s}} + \Zn{s}$ 
and using \eqref{E: zeta-1(i) = 1 - min(j)} we can rewrite
\begin{equation*}
\begin{aligned}
\Ineligible{\floor{s}} - \floor{s} 
&= \floor{s} - \ZetaMinus{\floor{s}+1} + \znt(\floor{s}) - \floor{s} \\
&= 1 - \min_{u \leq \floor{s}} \znt(u) + \znt(\floor{s}),
\end{aligned}
\end{equation*}
\fxfatal{Where does the 1 go?}
and the conditional intensity becomes
\begin{equation} \label{E: rate Nnt 2}
(1 - \min_{u \leq \floor{s}} \znt(u) + \znt(\floor{s}) \ps.
\end{equation}
We now rescale the counting process via
\begin{equation} \label{E: rescale Nnt}
\rnnt(s) = \nnt(\n{2}{3}s).
\end{equation}
We calculate the rate of this rescaled process.
Recall that the conditional intensity $\bar{\lambda}(s)$ of the process $\rnnt(s)$ must satisfy
\begin{equation}
\Exp{\rnnt(s)} = \int_{0}^{s} \lambda(u) du.
\end{equation}
Denote the rate of $\nnt$ by $\lambda(s)$ and refer to \eqref{E: rescale Nnt} to evaluate
\begin{equation*}
\begin{aligned}
\Exp{\rnnt(s)}
&= \Exp{\nnt(\n{2}{3}s)} \\
&= \int_{0}^{\n{2}{3}s} \lambda(u) du \\
&= \int_{0}^{s} \n{2}{3} \lambda(\n{2}{3}u) du.
\end{aligned}
\end{equation*}
Comparing both rates directly gives us
\begin{equation*}
\begin{aligned}
\bar{\lambda}(s)
&= \n{2}{3} \lambda(\n{2}{3}s) \\
&= \n{2}{3} \frac{1 - \min_{u \leq \n{2}{3}s} \znt(u) + \znt(\n{2}{3}s)}{1 - (\n{2}{3}s - \floor{\n{2}{3}s})\p} \p \\
&= \n{2}{3} \frac{1 - \n{1}{3} \min_{u \leq s} \rznt(u) + \n{1}{3}\rznt(s)}{1 - (\n{2}{3}s - \floor{\n{2}{3}s})\p} \p \\
&= \underbrace{n \p}_{\rightarrow 1} \frac{\n{-1}{3} - \min_{u \leq s} \rznt(u) + \rznt(s)}{1 - (\n{2}{3}s - \floor{\n{2}{3}s})\p} \\
&\xrightarrow{n \rightarrow \infty} \rznt(s) - \min_{u \leq s}\rznt(u).
\end{aligned}
\end{equation*}

By Theorem~\ref{T: Z -> W} we have $\rznt \rightarrow_d \Wt$,
so
\begin{equation}
\rznt(s) - \min_{u \leq s}\rznt(u) \rightarrow_d \Wt(s) - \min_{u \leq s}\Wt(u) = \Bt.
\end{equation}


The rate of the counting process $\Nt$ therefore converges to $\Bt$.
\fxfatal{Find out what's the problem with the joint convergence.}


\section{On weak convergence}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION: On weak convergence
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\fxnote{Introductory text.}

\fxnote{Definition weak convergence}
This section will probably move to a preliminary chapter.
\begin{definition}[Weak convergence]
	Let $S$ be a metric space and $\mathcal{S}$ it's class of Borel sets.
	Let $P, P_1, P_2, \dots$ be probability measures on defined on $S$.
	We say $P_n$ converges weakly to $P$, $P_n \Rightarrow P$, if
	\begin{equation} 
	\int_S fdP_n \xrightarrow{n \rightarrow \infty} \int_S fdP
	\end{equation}
	holds for all continuous, bounded functions $f: S \rightarrow \Real$.
\end{definition}

This definition now applies to convergence in distribution of random variables as follows:
Let $X, X_1, X_2, \dots$ be random variables on some probability space $S$.
Let $P, P_1, P_2, \dots$ be the corresponding distributions. 

\begin{definition}[Tightness] \label{D: Tightness}
	Inhalt...
\end{definition}

\begin{definition}[Relative compactness] \label{D: Rel Compactness}
	Inhalt...
\end{definition}

\begin{theorem}[Prohorov's theorem] \label{T: Prohorov}
	Let $P_n$ be a series of probability measures on some metric space $S$. If $P_n$ is tight, then it is relatively compact.
\end{theorem}



We will prove weak convergence by showing that
\begin{equation}
\Exp{ f(\bar{Z}^t_n, \bar{N}_n) } \longrightarrow \Exp{ f(W^t, N) }
\end{equation}
as $n \rightarrow \infty$, 
for all continuous, bounded functions 
$f: D^2 \rightarrow \Real$.


\section{Weak convergence of $(Z^t_n, N^t_n)$}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SECTION: Weak convergence of $(Z^t_n, N^t_n)$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We begin this chapter by an introduction on what the rate of a counting process means.
This includes those pictures in my notes on the height of the excursion and stuff.
We define $B_n$ to be the "height" of the exploration in $\Gnt$, aka the discrete version of $\Bt$.
We now state the main Theorem of this chapter.
\begin{theorem} \label{T: Joint Convergence}
	For the previously defined processes $\rznt$ and $\rnnt$,
	the joint weak convergence
	\begin{equation}
	( \rznt(s), \rnnt(s); s \geq 0 ) \longrightarrow_d (\Wt(s), \Nt(s); s \geq 0)
	\end{equation}
	holds, where $\Nt$ is the counting process with conditional intensity $\Bt$,
	i.e. the process for which
	\begin{equation*}
	\Nt(s) - \int_{0}^s \Bt(u)du
	\end{equation*}
	is a martingale.
\end{theorem}
\begin{proof}

For $n \in \Nat$ consider the process $\nnt$.
The increase of $\nnt$ in between times $i-1$ and $i$ will be $\Binom(\Bn{i-1},\p)$-distributed.
Define $\rnnt(s) = \nnt(\n{2}{3}s)$.

We want to show that
\begin{equation}
(\rznt, \rnnt) \rightarrow_d (\Wt, \Nt),
\end{equation}
meaning 
\begin{equation}
\Exp{f(\rznt, \rnnt)} \xrightarrow{n \rightarrow \infty} \Exp{f(\Wt, \Nt)}
\end{equation}
for all continuous, bounded functions $f:D[0,T]^2\rightarrow\Real$.

We already know that $\rznt \rightarrow_d \Wt$, which implies two conditions.
First, $\rznt$ is tight, 
so for all $\epsilon>0$ there exists a compact $K \subset D[0,T]$ such that
\begin{equation}
\inf_n \Prob ( \rznt \in K) > 1 - \epsilon.
\end{equation}

Second, $\rznt$ converges in finite dimensional distributions.
So for all $s_1 < s_2 < \dots < s_k$:
\begin{equation}
(\rznt(s_1), \dots, \rznt(s_k)) \rightarrow_d (\Wt(s_1), \dots, \Wt(s_k)).
\end{equation}

We can use the Skorohod representation theorem to define random variables $X$, $X_1$, $X_2$, \dots
on the same probability space, such that $X \sim \Wt$, $X_i \sim \bar{Z}^t_i$ for all $i$
and $X_n \rightarrow_{text{a.s.}} X$.
For random variables mapping to functions, we have
\begin{equation}
\sup_{s \in \Real_{\geq 0}} |X_n(s) - X(s)| \rightarrow_{text{a.s.}} 0.
\end{equation}
So
\begin{equation} 
\sup_{s \in \Real_{\geq 0}} |X_n(s) - X(s)| \rightarrow_p 0,
\end{equation}
meaning for all $\epsilon > 0$:
\begin{equation}
\Prob( \sup_{s \in \Real_{\geq 0}} |X_n(s) - X(s)| > \epsilon ) \rightarrow 0.
\end{equation}
From now on, writing $\rznt$ and $\Wt$ we mean these random variables.






\end{proof}


We can now assure ourselves that the overestimated probability \eqref{E: rate Nnt} is asymptotically negligible.
Assume the chance that any vertex encounters two or more surplus edges is non-zero and does not converge to zero as $n \rightarrow \infty$.
If a vertex connects by multiple excess edges, the process $\nnt$ makes two or more jumps during the time-interval of length $1$.
The rescaling \eqref{E: rescale Nnt} compresses the time axis until, in the limit process $\Nt$, 
any distance in an interval of original length $1$ will be reduced to a single point.
Therefore there would be a non-zero chance that the counting process has multiple coincident points.
By general theory on counting processes, this is not possible.
\fxnote{Find quote for theory on counting processes.}
So the probability of a vertex having multiple surplus edges must tend to zero.

















